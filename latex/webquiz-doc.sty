%-----------------------------------------------------------------------------
%  Copyright (C) 2004-2017 Andrew Mathas, University of Sydney
%
%  Distributed under the terms of the GNU General Public License (GPL)
%                  http://www.gnu.org/licenses/
%
% This file is part of the WebQuiz system.
%
% <Andrew.Mathas@sydney.edu.au>
%-----------------------------------------------------------------------------

% common latex code in the documentation files
\RequirePackage{cmap} % fix search and cut-and-paste in Acrobat

\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}

\RequirePackage{enumitem}
\setlist[itemize]{nosep}
\setlist[description]{
    font=\sffamily\bfseries\color{DodgerBlue},
    labelwidth=\textwidth
}

\RequirePackage{graphicx}

\RequirePackage{xspace}
\RequirePackage{xcolor}

\newcommand\WebQuiz{{\color{SaddleBrown}\textsc{WebQuiz}}\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Read the webquiz.ini file into \pgfkeys for later use so that we
%% don't need to hard-code this information. We allow unknown keys so
%% that we can slurp in all of the information in the file into
%% \pgfkeys{/webquiz}
\RequirePackage{pgfkeys}
\pgfkeys{/webquiz/.is family, /webquiz,
  % allow arbitrary unknown keys and set with \pgfkeyssetvalue
  .unknown/.code={\pgfkeyssetvalue{\pgfkeyscurrentpath/\pgfkeyscurrentname}{#1}},
}
\newcommand\webquiz[1]{\pgfkeysvalueof{/webquiz/#1}}

% split input line into key-value pairs -- necessary as commas can appear in the value
\RequirePackage{xparse}
% \AddIniFileKeyValue{key=value} - take a single argument and split it on =
\NewDocumentCommand{\AddIniFileKeyValue}{ >{\SplitList{=}} m }{%
  \AddIniFileValue #1%
}
% put a key-value pair into \pgfkeys{/webquiz}
% \AddIniFile{key}{value}  - note that value may contain commas
\newcommand\AddIniFileValue[2]{\expandafter\pgfkeys\expandafter{/webquiz,#1={#2}}}

% read the webquiz.ini file into \pgfkeys{/webquiz}
\newread\inifile% file handler
\def\apar{\par}% \ifx\par won't work but \ifx\apar will
\newcommand\AddEntry[1]{\expandafter\pgfkeys\expandafter{/webquiz, #1}}
\openin\inifile=webquiz.ini% open file for reading
\loop\unless\ifeof\inifile% loop until end of file
  \read\inifile to \iniline% read line from file
  \ifx\iniline\apar% test for, and ignore, \par
  \else%
    \ifx\iniline\empty\relax% skip over empty lines/comments
    \else\expandafter\AddIniFileKeyValue\expandafter{\iniline}
    \fi%
  \fi%
\repeat% end of file reading loop
\closein\inifile% close input file

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% listings code for python and latex examples in webquiz documentation
\RequirePackage{listings}
\lstset{%
    % Basic design
    backgroundcolor=\color{LightYellow!50!White},
    basicstyle={\small\ttfamily},
    boxpos=c, % centered
    % frame
    framerule=2pt,
    frame=l,
    framerule=0.5mm,
    rulesep=10mm,
    rulecolor=\color{Peru},
    breaklines=true,
    % colours for keywords etc
    commentstyle=\color{DarkRed},
    keywordstyle=\color{MediumBlue},
    linewidth=14cm,
    basewidth  = {.5em,0.5em},
    numbers=none,
    resetmargins=true,
    tabsize=2,
    xleftmargin=10mm,
    classoffset=1,
    % Code design
    keywordstyle=\color{MediumBlue}\bfseries,
    keywordstyle={[2]\color{SandyBrown}},
    keywordstyle={[3]\color{ForestGreen}},
    commentstyle=\color{BurlyWood}\ttfamily,
    stringstyle=\color{Coral},
    tabsize=4,
    showtabs=false,
    showspaces=false,
    showstringspaces=false,
}
\lstdefinestyle{latexcode}{
  language=[LaTeX]TeX,
  texcsstyle=*\bfseries\color{DodgerBlue},
  morekeywords={UnitCode,UnitName,UnitURL,QuizzesURL,BreadCrumbs,BreadCrumb,Institution,Department,DeclareGraphicsExtensions},
  classoffset=1,
  morekeywords={quiz, quizlist, discussion, question, choice, Choice, },
  classoffset=2,
  morekeywords={response,correct,incorrect,whenRight,whenWrong,answer},
}
\lstnewenvironment{latexcode}{\lstset{style=latexcode}}{}
\NewDocumentCommand\LaTeXCode{v}{\lstinline[style=latexcode]|#1|}

\lstdefinestyle{pythoncode}{
  language=HTML,
  upquote=true,
  classoffset=1,
  morekeywords={quiz_page},
}
\lstnewenvironment{pythoncode}{\lstset{style=pythoncode}}{}

\lstdefinestyle{htmlcode}{
  language=HTML,
  upquote=true,
  morekeywords={no}
  classoffset=1,
  morekeywords={quiz_page, side_menu, quiz_questions, quiz_header, no_script, include, breadcrumbs,},
}
\lstnewenvironment{htmlcode}{\lstset{style=htmlcode}}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{tcolorbox}
\tcbuselibrary{skins}
\NewDocumentCommand\ScreenShot{ O{0.8} m m }{%
  \begin{center}
    \begin{tcolorbox}[width=#1\textwidth, title=#2, arc=3mm,
      colframe=Peru,
      boxrule=0.2mm,
      colback=white,
      halign=center,
      enhanced,
      attach boxed title to bottom right={yshift=3mm, xshift=-3mm},
      fonttitle=\footnotesize,
      boxed title style={size=fbox, colback=white, arc=2mm},
      coltitle=Peru,
    ] \includegraphics[width=\textwidth]{#3}
    \end{tcolorbox}
  \end{center}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NewDocumentCommand{\Verb}{v}{{\color{blue}#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% hyperref settings
\RequirePackage{hyperref}
\hypersetup{%
    colorlinks=true,
    linkcolor=SaddleBrown,
    urlcolor=Brown,
    pdfauthor   = {\webquiz{authors}                       },
    pdfkeywords = {\webquiz{keywords}                      },
    pdfsubject  = {\webquiz{description}                   },
    pdfinfo     = {%
        copyright    = {\webquiz{copyright}},
        licence      = {\webquiz{licence}},
        release date = {\webquiz{release date}},
        url          = {\webquiz{url}},
    }
}

\endinput
