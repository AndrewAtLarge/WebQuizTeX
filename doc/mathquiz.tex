%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title:    MathQuiz
% Author:   Andrew Mathas
% Created:  April 2017
% Modified: 15:15 Monday, 10 April 2017
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\synctex=1

\documentclass[svgnames]{article}
\usepackage[a4paper,margin=30mm]{geometry}
\parindent=4mm
\parskip=1mm
\hfuzz 5pt

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{cmap} % fix search and cut-and-paste in Acrobat
\usepackage{stix}

\usepackage{xspace}

\usepackage{enumitem}
\setlist[itemize]{nosep}
\setlist[description]{
    font=\sffamily\bfseries\color{DodgerBlue},
    labelwidth=\textwidth
}

\usepackage{graphicx}
\usepackage{pdfpages}

\setcounter{secnumdepth}{0}
% \renewcommand\section[1]{%
%   \ifx#1*\relax\else%
%     \noindent\textcolor{blue}{\Large \textsc{#1}}%
%     \addcontentsline{toc}{subsection}{#1}%
%   \fi
% }
\renewcommand*\contentsname{\relax}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Read the mathquiz.ini file into \pgfkeys for later use so that we
%% don't need to hard-code this information. We allow unknown keys and
%% slurp in all of ythe information in the file
\usepackage{pgfkeys}
\pgfkeys{/mathquiz/.is family, /mathquiz,
  % allow arbitrary unknown keys and set with \pgfkeyssetvalue
  .unknown/.code={\pgfkeyssetvalue{\pgfkeyscurrentpath/\pgfkeyscurrentname}{#1}},
}
\newcommand\mathquiz[1]{\pgfkeysvalueof{/mathquiz/#1}}

% split input line into key-value pair -- necessary as commas can appear in the value
\usepackage{xparse}
\NewDocumentCommand{\AddIniFileKeyValue}{ >{\SplitList{=}} m }{%
  \AddIniFileValue #1%
}
% put a key-value pair into \pgfkeys{/cycles}
\newcommand\AddIniFileValue[2]{\expandafter\pgfkeys\expandafter{/mathquiz,#1={#2}}}

% read the mathquiz.ini file into \pgfkeys{/mathquiz}
\newread\inifile% file handler
\def\apar{\par}% \ifx\par won't work but \ifx\apar will
\newcommand\AddEntry[1]{\expandafter\pgfkeys\expandafter{/mathquiz, #1}}
\openin\inifile=mathquiz.ini% open file for reading
\loop\unless\ifeof\inifile% loop until end of file
  \read\inifile to \iniline% read line from file
  \ifx\iniline\apar% test for, and ignore, \par
  \else%
    \ifx\iniline\empty\relax% skip over empty lines/comments
    \else\expandafter\AddIniFileKeyValue\expandafter{\iniline}
    \fi%
  \fi%
\repeat% end of file reading loop
\closein\inifile% close input file

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% listings code for python and latex examples
\usepackage{listings}\lstset{language=[LaTeX]TeX,framerule=2pt}
\lstset{language=[LaTeX]TeX,
        backgroundcolor=\color{Ivory},
        basewidth  = {.5em,0.5em},
        basicstyle = \small\ttfamily,
        boxpos=c, % centered
        breaklines=true,
        commentstyle=\color{Brown},
        keywordstyle=\color{Blue},
        linewidth=14cm,
        numbers=none,
        resetmargins=true,
        tabsize=2,
        texcsstyle=*\bfseries\color{Blue},
        xleftmargin=10mm,
        morekeywords={UnitCode,UnitName,UnitURL,QuizzesURL,BreadCrumb,University,Department,quiz,quizlist,discussion,
                      question,choice,Choice,response,correct,incorrect,whenRight,whenWrong,answer},
}
% hyperref links to ctan
\newcommand\ctan[1]{\href{https://www.ctan.org/pkg/#1}{\texttt{#1}}}

\NewDocumentCommand{\Verb}{v}{{\color{blue}#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% MathQuiz title box for front page
\usepackage{tikz}
\usetikzlibrary{shadows.blur}
\tikzset{shadowed/.style={blur shadow={shadow blur steps=5},
                          bottom color=LightSkyBlue!30,
                          draw=MidnightBlue!70,shade,
                          font=\normalfont\Huge\bfseries\scshape,
                          rounded corners=8pt,
                          top color=SkyBlue,
      },
      boxes/.style={draw=MidnightBlue,
                    fill=Cornsilk,
                    font=\sffamily\small,
                    inner sep=5pt,
                    rectangle,
                    rounded corners=8pt,
                    text=RoyalBlue,
     }
}
\def\MathQuiz{\textcolor{SlateBlue}{\textsc{MathQuiz}}\xspace}
\def\MathQuizTitle{
  \begin{tikzpicture}[remember picture,overlay]
      \node[yshift=-3cm] at (current page.north west)
        {\begin{tikzpicture}[remember picture, overlay]
          \draw[shadowed](30mm,0) rectangle node[white]{MathQuiz} (\paperwidth-30mm,16mm);
          \node[MidnightBlue,font=\normalfont\small\itshape] at (\paperwidth/2,2mm) {\small On-line quizzes written in LaTeX};
          \node[anchor=west,boxes] at (4cm,0cm) {\mathquiz{name}};
          \node[anchor=east,boxes] at (\paperwidth-4cm,0) {\mathquiz{version}};
         \end{tikzpicture}
        };
   \end{tikzpicture}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% headers and footers
\makeatletter
\def\@oddfoot{\tiny\MathQuiz -- \mathquiz{version}\hfill\thepage}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% hyperref settings
\usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
\hypersetup{ pdfauthor   = {\mathquiz{authors}                       },
             pdfkeywords = {\mathquiz{keywords}                      },
             pdfsubject  = {\mathquiz{description}                   },
             pdftitle    = {\mathquiz{program} --- \mathquiz{version}},
             pdfinfo     = {%
                 copyright    = {\mathquiz{copyright}},
                 licence      = {\mathquiz{licence}},
                 release date = {\mathquiz{release date}},
                 url          = {\mathquiz{url}},
             }
}


\begin{document}

    \MathQuizTitle

    \begin{quote}
        \MathQuiz makes it possible to write on-line quizzes using
        \LaTeX, providing an easy way for anyone who knows \LaTeX\ to
        create an on-line quiz using \LaTeX\ file.  The
        allows the quiz author to concentrate on the content of quizzes,
        unencumbered by the technicalities of HTML and javascript.

        \begin{center}
        \fbox{\includegraphics[width=0.8\textwidth]{quiz-page}}
        \end{center}

        \begin{center}
        \begin{minipage}{0.7\textwidth}
          \hspace*{3em}\tableofcontents
        \end{minipage}
        \end{center}

        \bigskip
        \begin{tabular}{@{}ll}
        Authors             & \mathquiz{authors}\\
        Maintainer          &  \mathquiz{name}\\
        System requirements & python3 and \LaTeX, including \TeX 4ht and \textsc{make4ht}\\
        Licence             & \mathquiz{licence}\\
        Date                & \mathquiz{release date}
        \end{tabular}
    \end{quote}


    \newpage

\section{Introduction}
    On-line quizzes provide a good way to reinforce learning, especially
    because they can give ``interactive'' feedback to the students that
    is based on the submitted responses. Unfortunately, in addition to
    writing the quiz content there are significant technical hurdles
    that need to be overcome when writing an on-line quiz -- and there
    are additional complications if the quiz involves mathematics or
    diagrams. On the other hand, professional mathematicians and
    educators use \LaTeX\ to write their research papers, books and
    teaching materials.  \MathQuiz merges these two paradigms and makes
    it possible to write on-line quizzes using \LaTeX.

    \MathQuiz supports the following three types of questions:
    \begin{itemize}
      \item Multiple choice questions with a unique correct answer
      \item Multiple choice questions zero or more correct answers
      \item Questions with a numerical answer.
    \end{itemize}
    Each time a student answers a questiuon they are told whether they
    are right or wrong and it is possible for the quiz author to give
    targeted feedback ti the student based on their answer. In
    principle, anything that can be written using \LaTeX\ can appear in
    the on-line quiz.

    In principle, the quiz can contain anything that can be typeset
    using \LaTeX.  In practise, the \LaTeX\ is converted to HTML using
    \href{https://www.tug.org/applications/tex4ht/mn.html}{\TeX 4ht},
    and \href{https://github.com/michal-h21/make4ht}{make4ht}, which are
    packaged with most \TeX\ distributions. The quizzes constructed
    using \MathQuiz can use anything in \LaTeX\ that is understood by
    \TeX 4ht, which is almost everything.

    The easiest way to explain how \MathQuiz works is by example. The
    following \LaTeX\ file defines a quiz with a single multiple choice
    question that has four possible answers, each of which has a
    customised response.  (Responses to answers are optional, but they
    are one main pedagogical advantages of on-line quizzes because they
    allow you to give instant feedback to the person taking the quiz.)

    \lstinputlisting{example.tex}

    Since this is a \LaTeX\ file it can be processed using
    \texttt{latex} and \texttt{pdflatex} to produce a readable and
    printable version of the quiz, which is useful when proofreading. In
    the case the\LaTeX\ version of the quiz looks something like the
    following:

    \begin{center}
      \fbox{\includegraphics[width=0.4\textwidth]{example-pdf}}
    \end{center}

    Of course, the real reason for using \MathQuiz is that it is also
    possible to make an on-line version of the quiz by processing the
    quiz using the \texttt{mathquiz} command. If you do this, and then open
    the web page in your favourite browser, you will see a web page
    that looks something like this:

    \begin{center}
      \fbox{\includegraphics[width=0.8\textwidth]{example-html}}
    \end{center}

    The web page version of the quiz displays one question at a time,
    with the question buttons serving the dual purpose of providing a
    way navigate between the questions in the quiz and displaying
    whether the question has not been answered or if it has been
    answered, correctly, corretly on the first attempt or answered
    incorrectly. Targeted feedback can be given to the person taking the
    quiz based on their responses.

    As explained in \autoref{S:documenntclass} and , it is possible to
    customise some aspects of the web pages constructed by \MathQuiz.
    \autoref{S:installation} explains how the page layout can be altered
    to suit local requirements with some rudimentary python the quizze.

\section{Credits}
    \MathQuiz{} was written and developed in the
    \href{http://www.maths.usyd.edu.au/}{School of Mathematics and
    Statistics} at the \href{http://www.usyd.edu.au/}{University of
    Sydney}.  The system is built on \LaTeX{} with the conversion from
    \LaTeX{} to HTML being done by Eitan Gurari's
    \href{http://www.cis.ohio-state.edu/~gurari/TeX4ht/mn.html}{TeX4ht},
    and Michal Hoftich's
    \href{https://github.com/michal-h21/make4ht}{make4ht}.

    To write quizzes using \MathQuiz it is only necessary to know
    \LaTeX, however, the \MathQuiz system has three components:
    \begin{itemize}
      \item A \LaTeX{} document class file, \texttt{mathquiz.cls}, and
      a \TeX 4ht configuration file, \texttt{mathquiz.cfg}, that enable the
      quiz files to be processed by \LaTeX{} and \LaTeX 4ht,
      respectively.
      \item A python program, \texttt{mathquiz}, that translates the xml
      file that is produced by \TeX 4ht into  HTML.
      \item Some javascript and css that controls the quiz web page.
    \end{itemize}

   The \LaTeX{} component of \MathQuiz{} was written by Andrew Mathas
   and the python and javascript code were written by Andrew Mathas and
   Don Taylor, based on an initial protype of Don Taylor's from 2001.
   Since 2004 the program has been maintained and developed by Andrew
   Mathas. Although the program has changed substantially since 2004
   some of Don's code and, in particular, his idea of using \TeX 4ht are
   still very much in use.

   For version 5, thanks are due to Bob Howlett and Michal Hoftich for
   comments and technical advice.

  \section{What \MathQuiz does and does not do}

    The quizzes made using \MathQuiz are intended to be used as a
    revision resource rather than as an assessment tool. In particular,
    \MathQuiz does not provide a mechanism for recording the marks
    on the quizzes. Technically this would not be very hard to do but it
    would be more difficult to ensure that the quizzes are secure.
    Currently the answers to the quiz are not part of the HTML source
    code for the quiz, however, there are easy ways to access then if
    you know when you are doing.

    There is no limit on the number of times that a question, or indeed
    the entire quiz, can be attempted.

    The questions in a \MathQuiz quiz are static. In particular, they do
    not accept variables and each person taking the quiz will get
    exactly the same questions. It would not be hard to make the
    questions appear in a random order.Randomising the order of the
    multiple choice answers would be more difficult.

    \MathQuiz is able to ask ``computational'' questions that accept a
    numerical answer, however, it does not accept symbolic answers. So,
    for example, if the answer to a question is $0$ then $\sin(0)$ will
    not be accented as a correct answer and the only way to ask for the
    indefinite integral of a function is as a multiple choice question.

    The quizzes are not timed.pas

    Some of these issues may be addressed in future releases.

\section{The \MathQuiz document class}\label{S:documenntclass}

\begin{description}
  \item[$\backslash$BreadCrumb]
     The last item in the web page breadcrumb, which refers to the current quiz.

     Default: the quiz \texttt{title}, as set by \verb!\title!.

  \item[$\backslash$Department]
    The name of the department that runs this unit (for example,
    Mathematics). This appears below the question buttons on the quiz web
    page.

    The department can be set globally using \texttt{mathquiz --edit-settings}.

    Default: \texttt{School of Mathematics and Statistics}

  \item[$\backslash$DepartmentURL]
    The URL for the department that runs this unit. This appears below
    the question buttons on the quiz web page.

    The department URL can be set globally using \texttt{mathquiz --edit-settings}.

    Default: \texttt{http://www.maths.usyd.edu.au}

  \item[$\backslash$QuizzesURL]
    The URL for the suite of quizzes attached to this unit of study. This
    is used in the breadcrumb at the top of the quiz web page.

    Default: \texttt{Unit code???}

  \item[$\backslash$UnitCode]
    The unit of study code for the course that the quiz is attached
    to. This is used in the breadcrumb at the top of the quiz web page.

    Default: \texttt{Unit code???}

  \item[$\backslash$UnitName]
    The name of the unit of study for the course that the quiz is attached
    to. This is used in the breadcrumb at the top of the quiz web page.

    Default: \texttt{Unit name???}

  \item[$\backslash$UnitURL]
    The URL for the unit of study code for the course that the quiz is attached
    to. This is used in the breadcrumb at the top of the quiz web page.

    Default: \texttt{Unit URL???}

  \item[$\backslash$University]
    The university, or institution, that appears below the question
    buttons on the quiz web page.

    The university can be set globally using \texttt{mathquiz --edit-settings}.

    Default: \texttt{University of Sydney}

  \item[$\backslash$UniversityURL]
    The URL for the university, or institution, that appears below the
    question buttons on the quiz web page.

    The university URL can be set globally using \texttt{mathquiz --edit-settings}.

    Default: \texttt{https://www.sydney.edu.au}
\end{description}

\subsection{Mathquiz class options}

\begin{description}
  \item[pst2pdf] The quiz should be preprocessed by \texttt{pst2pdf},
  which converts all postscript objects in the quiz to images. This
  sometimes fixes issues with diagrams drawn using \ctan{pstricks},
  This is equivalent to the command-line option \texttt{--pst2pdf}.
\end{description}

All other class options are passed given to the \texttt{article} class, which is
the base class used by \texttt{mathquiz}.

\section{Command line options}

    The following options can either be used inside \Verb|\MathQuiz| to
    control the formatting \textit{locally} for just the unit being


    \begin{description}
       \item[ -h, --help]            show this help message and exit
       \item[-p, --pst2pdf]
          Use pst2pdf to fix issues with images generated by pstricks
       \item[-s,--shell-escape]
          Shell escape for htlatex/make4ht
       \item[--initialise]
          Initialise files and setings for mathquiz
       \item[--settings]
          List system settings for mathquiz
       \item[--edit-settings]
          Edit mathquiz settings
       \item[--build MATHQUIZ\_MK4]
          Build file for make4ht
       \item[-q, --quiet]
          Suppress tex4ht messages (also -qq etc)
       \item[-l LOCAL\_PAGE, --local LOCAL\_PAGE]
          Local python code for generating the quiz web page
    \end{description}

\section{System installation and configuration}\label{S:installation}

    To use the system you will need to have all of the following programs installed:
    \begin{itemize}
         \item \LaTeX, \TeX 4ht and \textsc{make4ht}
         All of these are available through standard \TeX\ installations
         such as \TeX live
         \item Python3
         \item \MathQuiz
    \end{itemize}

    \MathQuiz will soon be submitted to ctan, in which case it will soon
    be incorporated into \TeX live.

\section{Local customisation}

  The "style" of the online quizzes is controlled by the file
  \verb!mathquiz_local.py!. If you want to change this format of the quiz
  pages then the easiest way to do this is to make a copy of
  \verb!mathquiz_local.py!, say to mathquizMyStyle.py, and then edit this file
  directly. To see what the new style looks like you can run the
  mathquiz script with an optional argument which tells mathquiz to use
  your style instead: mathquiz -l mathquizMyStyle quizfile.tex Using
  mathquiz to regenerate the html files is quite time consuming, so
  while you are editing this file you will find it easier if you ask
  mathquiz not to delete the intermediate files that it creates each
  time. To do this first run mathquiz with the -x option and thereafter
  use -f: mathquiz -l mathquizMyStyle -x quizfile.tex   \# tells
  MathQuiz not to delete intermediate files mathquiz -l mathquizMyStyle
  -f quizfile.tex   \# "fast" option when intermediate files exist Once
  the new page format is finalized it can be made the default by setting
  MathQuizOptions="--local=mathquizMyStyle" at the top of the mathquiz
  shell script.

  The easiest way to change \verb!mathquiz_local.py! is simply to edit the
  "decorating" html that this file puts around the quiz page. You may
  also need to change the CSS style sheet for mathquiz which is the file
  web/mathquiz.css. More sophisticated versions of \verb!mathquiz_local.py!
  where you change the underlying python code are of course possible.
  For example, at the University of Sydney our version of this file
  calls our content management system directly and uses this to create
  the web page for the quiz.

\begin{lstlisting}[
  language=Python,
  showstringspaces=false,
  tabsize=4,
  morekeywords={title, include, breadcrumbs,quiz_page,side_menu,quiz_header,quiz_questions}]
quiz_page = r'''<!DOCTYPE HTML>
<html lang="en-AU">
<head>
  <title> {title} </title>
  {include}
</head>

<body>
  {breadcrumbs}
  {no_script}
  <div class="quiz_page">
    {side_menu}
    {quiz_header}
    <div class="quiz_questions">
      {quiz_questions}
    </div>
  </div>
</body>
</html>
'''
\end{lstlisting}




  \section{The on-line manual}

    \includepdf[pages=-]{mathquiz-manual}

\begin{verbatim}
.. _`Andrew Mathas`: http://www.maths.usyd.edu.au/u/mathas/
.. _GPL: https://www.gnu.org/licenses/gpl-3.0.en.html
.. _LaTeX: https://www.latex-project.org/
.. _MathQuiz: http://www.maths.usyd.edu.au/u/MOW/MathQuiz/doc/mathquiz-manual.html
.. _Python: https://www.python.org
.. _TeX4ht: http://www.tug.org/tex4ht/
.. _texlive: https://www.tug.org/texlive/
\end{verbatim}

\section{Licence}

Copyright (C) 2013-2017

GNU General Public License, Version 3, 29 June 2007

This program is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License (GPL) as published by the Free
Software Foundation, either version 3 of the License, or (at your option) any
later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU General Public License for more details.

\end{document}
