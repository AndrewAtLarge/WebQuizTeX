%-----------------------------------------------------------------------------
%  Copyright (C) 2004-2017 Andrew Mathas, University of Sydney
%
%  Distributed under the terms of the GNU General Public License (GPL)
%                  http://www.gnu.org/licenses/
%
% This file is part of the MathQuiz system.
%
% <Andrew.Mathas@sydney.edu.au>
%-----------------------------------------------------------------------------

% common latex code in the documentation files

\usepackage{xspace}
\def\MathQuiz{\textcolor{SlateBlue}{\textsc{MathQuiz}}\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Read the mathquiz.ini file into \pgfkeys for later use so that we
%% don't need to hard-code this information. We allow unknown keys and
%% slurp in all of the information in the file
\usepackage{pgfkeys}
\pgfkeys{/mathquiz/.is family, /mathquiz,
  % allow arbitrary unknown keys and set with \pgfkeyssetvalue
  .unknown/.code={\pgfkeyssetvalue{\pgfkeyscurrentpath/\pgfkeyscurrentname}{#1}},
}
\newcommand\mathquiz[1]{\pgfkeysvalueof{/mathquiz/#1}}

% split input line into key-value pairs -- necessary as commas can appear in the value
\usepackage{xparse}
\NewDocumentCommand{\AddIniFileKeyValue}{ >{\SplitList{=}} m }{%
  \AddIniFileValue #1%
}
% put a key-value pair into \pgfkeys{/cycles}
\newcommand\AddIniFileValue[2]{\expandafter\pgfkeys\expandafter{/mathquiz,#1={#2}}}

% read the mathquiz.ini file into \pgfkeys{/mathquiz}
\newread\inifile% file handler
\def\apar{\par}% \ifx\par won't work but \ifx\apar will
\newcommand\AddEntry[1]{\expandafter\pgfkeys\expandafter{/mathquiz, #1}}
\openin\inifile=mathquiz.ini% open file for reading
\loop\unless\ifeof\inifile% loop until end of file
  \read\inifile to \iniline% read line from file
  \ifx\iniline\apar% test for, and ignore, \par
  \else%
    \ifx\iniline\empty\relax% skip over empty lines/comments
    \else\expandafter\AddIniFileKeyValue\expandafter{\iniline}
    \fi%
  \fi%
\repeat% end of file reading loop
\closein\inifile% close input file

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% listings code for python and latex examples in mathquiz documentation
\usepackage{listings}
\lstdefinestyle{latexcode}{
  language=[LaTeX]TeX,
  backgroundcolor=\color{Azure!50},
  basewidth  = {.5em,0.5em},
  basicstyle = \small\ttfamily,
  boxpos=c, % centered
  framerule=2pt,
  breaklines=true,
  commentstyle=\color{DarkRed},
  keywordstyle=\color{MediumBlue},
  linewidth=14cm,
  numbers=none,
  resetmargins=true,
  tabsize=2,
  texcsstyle=*\bfseries\color{DodgerBlue},
  xleftmargin=10mm,
  classoffset=1,
  keywordstyle={\color{ForestGreen}},
  morekeywords={UnitCode,UnitName,UnitURL,QuizzesURL,BreadCrumb,University,Department},
  classoffset=2,
  keywordstyle={\color{SandyBrown}},
  morekeywords={quiz,quizlist,discussion,question,choice,Choice},
  classoffset=3,
  keywordstyle={\color{DarkViolet}},
  morekeywords={response,correct,incorrect,whenRight,whenWrong,answer},
}
\lstnewenvironment{latexcode}{\lstset{style=latexcode}}{}

\lstdefinestyle{pythoncode}{
  language=HTML,
  upquote=true,
  backgroundcolor=\color{AliceBlue},
  basewidth  = {.5em,0.5em},
  basicstyle = \small\ttfamily,
  boxpos=c, % centered
  breaklines=true,
  showstringspaces=false,
  tabsize=4,
  classoffset=1,
  keywordstyle={\color{ForestGreen}},
  morekeywords={quiz_page,side_menu,quiz_questions,breadcrumbs,include,title},
}
\lstnewenvironment{pythoncode}{\lstset{style=pythoncode}}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NewDocumentCommand{\Verb}{v}{{\color{blue}#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% hyperref settings
\usepackage{hyperref}
\hypersetup{%
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
    pdfauthor   = {\mathquiz{authors}                       },
    pdfkeywords = {\mathquiz{keywords}                      },
    pdfsubject  = {\mathquiz{description}                   },
    pdfinfo     = {%
        copyright    = {\mathquiz{copyright}},
        licence      = {\mathquiz{licence}},
        release date = {\mathquiz{release date}},
        url          = {\mathquiz{url}},
    }
}

\endinput
