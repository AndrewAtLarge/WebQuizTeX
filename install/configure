#!/bin/sh -f

# Configuration script for MathQuiz    - Andrew Mathas January 2005.

#-------------------------------------------------------------------#
Echo="/bin/echo "

#-------------------------------------------------------------------#
# intro
cat <<!!
----------------------------------------------------------------------
MathQuiz is a system for writing interactive web based quizzes which
involve a lot of mathematics. The quiz are first written in LaTeX and
then converted into HTML files using MathQuiz.

To use the system you will need to have latex, tex4ht and python
(together with the xml.sax libraries) installed. In order for MathQuiz
to work this scripts needs:
  o A (system) directory in which to install LaTeX class files.
  o A directory on your web server web tree in which to place the javscript
    files, the on-line manual and the image files used by MathQuiz.
  o A relative URL to the web directory above.
  o A (system) directory in which to put the python scripts which
    form the heart of MathQuiz.
  o The name of a directory in the system path (eg. /usr/local) in
    which to put the the shell script which drives MathQuiz
You will be promted for each of these directories in turn.
----------------------------------------------------------------------

!!

#-------------------------------------------------------------------#
# Set MQ home directory
$Echo "o Please enter the mathquiz system directory (for example,"
$Echo "  /usr/local/share/src/mathquiz). Hit return to use the "
$Echo "  current directory. This directory  should NOT be on your"
$Echo "  web server: \c"
read MQHome
$Echo

test "$MQHome" = "" && MQHome=$PWD

mkdir -p $MQHome/python $MQHome/LaTeX
/bin/cp src/{mathquiz,mathquizXml}.py $MQHome/python
/bin/cp src/mathquiz.{ins,dtx} $MQHome/LaTeX

#-------------------------------------------------------------------#
# Set up the mathquiz files which live on the web server
$Echo "o Please enter the system path to the directory on your"
$Echo "  web server which will contain the mathquiz image and"
$Echo "  javascript files (e.g /web-server/scripts/mathquiz): \c"
read MQWebDirectory
$Echo

javascript = "$MQWebDirectory/javascript/mathquiz.js"

mkdir -p $MQWebDirectory $MQWebDirectory/{javascript,doc,css}
/bin/cp -R ../Images $MQWebDirectory 
echo "var Images = "'"'"$MQWebDirectory/Images/"'"'"; > $javascript
cat ../javacript/mathquiz.js >> $javascript
awk -v Web="$MQWebDirectory" \
  '{ if ( $0 ~ /^var Images/ ) {
      printf "var Images       = \"%sImages/\"\n", Web
     } else { print }
   }' src/mathquiz.js > $MQWebDirectory/javascript/mathquiz.js
/bin/cp src/usyd_internal.css $MQWebDirectory/css

#-------------------------------------------------------------------#
# and also find its URL
$Echo "o Please enter the (relative) URL for the directory that you"
$Echo "  just defined (e.g /scripts/mathquiz): \c"
read MQURL
$Echo
sed 's@MathQuizURL@'$MQURL'@' src/mathquizConfig > $MQHome/python/mathquizConfig.py

#-------------------------------------------------------------------#
# System bin directory
$Echo "o Please enter the name of the system directory where the"
$Echo "  mathquiz executable will be kept (or hit return to use"
$Echo "  /usr/local/bin): \c"
read MQBinDirectory
$Echo

mkdir -p $MQBinDirectory
sed 's@MathQuizHome@'$MQHome'@' src/mathquiz.sh > $MQBinDirectory/mathquiz
chmod a+x $MQBinDirectory/mathquiz

#-------------------------------------------------------------------#
# ...and now the latex files
$Echo "o Please enter the name of the system directory where the"
$Echo "  LaTeX class files should go. Ideally, the class file "
$Echo "  should be placed in a directory which is automatically"
$Echo "  searched by LaTeX (e.g /usr/local/tex/latex/mathquiz/): \c"
read MQLaTeXHome
$Echo

cd src
# unpack the dtx file and move the contents to the appropriate places
yes | latex mathquiz.ins > /dev/null
/bin/mv mathquiz.{cfg,dtd} $MQHome/python
mkdir -p $MQLaTeXHome
/bin/mv mathquiz.cls $MQLaTeXHome
/bin/mv mathquiz-manual.tex $MQWebDirectory/doc

#-------------------------------------------------------------------#
$Echo "The installation is now complete. You can test the system"
$Echo "by running mathquiz on mathquiz-manual.tex in the directory"
$Echo "$MQWebDirectory/doc"
